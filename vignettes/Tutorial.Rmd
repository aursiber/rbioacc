---
title: "Tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r loadPackage}
library(rbioacc)
library(ggplot2)
```

## Male Gammarus Single

```{r fitMGS, cache=TRUE}
data("Male_Gammarus_Single")
data_MGS = Male_Gammarus_Single
modelData_MGS <- modelData(data_MGS, time_accumulation = 4)
fit_MGS <- fitTK(modelData_MGS, iter = 10000)
# print(fit_MGS)
# save(fit_MGS, file = "data/fit_MGS.rda")
```

```{r statsMGS}
quantile_table(fit_MGS)
```

```{r plotMGS}
fit = fit_MGS # HACK for the S4 BUG
plot_fitTK(fit)
```

```{r ppcMGS}
ppc_fitTK(fit_MGS)
```

## Male Gammarus Merged

```{r fitMGM708, cache=TRUE}
data("Male_Gammarus_Merged")
data_MGM708 = Male_Gammarus_Merged[Male_Gammarus_Merged$expw == 7.08021e-05, ]
modelData_MGM708 = modelData(data_MGM708, time_accumulation = 4)
fit_MGM708 <- fitTK(modelData_MGM708, iter = 10000)
# print(fit_MGM708)
# save(fit_MGM708, file = "data/fit_MGM708.rda")
```

```{r statMGM708}
quantile_table(fit_MGM708)
```

```{r plotMGM708}
plot_fitTK(fit_MGM708)
```

```{r ppcMGM708}
ppc_fitTK(fit_MGM708)
```

```{r fitMGM141, cache=TRUE}
data_MGM141 = Male_Gammarus_Merged[Male_Gammarus_Merged$expw == 1.41604e-04, ]
modelData_MGM141 = modelData(data_MGM141, time_accumulation = 7)
fit_MGM141 <- fitTK(modelData_MGM141, iter = 20000)
# save(fit_MGM141, file = "data/fit_MGM141.rda")
```

```{r statMGM141}
quantile_table(fit_MGM141)
```

```{r plotMGM141}
plot_fitTK(fit_MGM141)
```

```{r ppcMGM141}
ppc_fitTK(fit_MGM141)
```

```{r fitMGM283, cache=TRUE}
data_MGM283 = Male_Gammarus_Merged[Male_Gammarus_Merged$expw == 2.83208e-04, ]
modelData_MGM283 = modelData(data_MGM283, time_accumulation = 4)
fit_MGM283 <- fitTK(modelData_MGM283, iter = 10000)
# save(fit_MGM283, file = "data/fit_MGM283.rda")
```

```{r statMGM283}
quantile_table(fit_MGM283)
```

```{r plotMGM283}
plot_fitTK(fit_MGM283)
```

```{r ppcMGM283}
ppc_fitTK(fit_MGM283)
```

## Male Gammarus seanine with growth

```{r fitMGSG, cache=TRUE}
data("Male_Gammarus_seanine_growth")
modelData_MGSG <- modelData(Male_Gammarus_seanine_growth, time_accumulation = 1.417)
fit_MGSG <- fitTK(modelData_MGSG, iter = 10000)
# print(fit_MGSG)
# save(fit_MGSG, file = "data/fit_MGSG.rda")
```

```{r statsMGSG}
quantile_table(fit_MGSG)
```

```{r plotMGSG}
fit = fit_MGSG
plot_fitTK(fit_MGSG)
```

```{r ppcMGSG}
ppc_fitTK(fit_MGSG)
```

## Oncorhynchus

```{r fitOT440, cache=TRUE}
data("Oncorhynchus_two") #  Pimephales_two
data_OT440 = Oncorhynchus_two[Oncorhynchus_two$expw == 0.00440,]
modelData_OT440 <- modelData(data_OT440, time_accumulation = 49)
fit_OT440 <- fitTK(modelData_OT440, iter = 10000)
# print(fit_OT440)
# save(fit_OT440, file = "data/fit_OT440.rda")
```

```{r statOT440}
quantile_table(fit_OT440)
```

```{r plotOT440}
plot_fitTK(fit_OT440)
```

```{r ppcOT440}
ppc_fitTK(fit_OT440)
```

```{r fitOT041, cache=TRUE}
data_OT041 = Oncorhynchus_two[Oncorhynchus_two$expw == 0.00041,]
modelData_OT041 <- modelData(data_OT041, time_accumulation = 49)
fit_OT041 <- fitTK(modelData_OT041, iter = 10000)
# print(fit_OT041)
# save(fit_OT041, file = "data/fit_OT041.rda")
```

```{r statOT041}
quantile_table(fit_OT041)
```

```{r plotOT041}
plot_fitTK(fit_OT041)
```

```{r ppcOT041}
ppc_fitTK(fit_OT041)
```


## Chironomus benzo-a-pyrene

```{r fitCB}
data("Chironomus_benzoapyrene")
modelData_CB <- modelData(Chironomus_benzoapyrene, time_accumulation = 3)
modelData_CB$unifMax = modelData_CB$unifMax  * 100
fit_CB <- fitTK(modelData_CB, iter = 10000)
# print(fit_CB)
# save(fit_CB, file = "data/fit_CB.rda")
```
 
```{r statCB}
quantile_table(fitCB)
```

```{r plotCB}
plot_fitTK(fitCB)
```

```{r ppcCB}
ppc_fitTK(fitCB)
```
